<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Golang on Mike Ball</title><link>/tags/golang/</link><description>Recent content in Golang on Mike Ball</description><generator>Hugo</generator><language>en-us</language><lastBuildDate>Thu, 14 Jul 2022 00:00:00 +0000</lastBuildDate><atom:link href="/tags/golang/index.xml" rel="self" type="application/rss+xml"/><item><title>Terraform Provider Development Demystified</title><link>/blog/terraform-provider-development-demystified/</link><pubDate>Thu, 14 Jul 2022 00:00:00 +0000</pubDate><guid>/blog/terraform-provider-development-demystified/</guid><description>&lt;p&gt;&lt;em&gt;Many Terraform practitioners may be unfamiliar with &lt;a href="https://www.terraform.io/language/providers"&gt;provider&lt;/a&gt; development. How are providers actually implemented? The following offers an outline of a brief presentation I gave to the &lt;a href="https://www.hbomax.com/"&gt;HBO Max&lt;/a&gt; Strategic Global Infrastructure team.&lt;/em&gt;&lt;/p&gt;
&lt;h2 id="review-of-the-basics"&gt;Review of the basics&lt;/h2&gt;
&lt;p&gt;First, let&amp;rsquo;s establish a foundation, especially for those who may be less familiar with &lt;a href="https://www.terraform.io/"&gt;Terraform&lt;/a&gt;.&lt;/p&gt;
&lt;h3 id="terraform-fundamentals"&gt;Terraform fundamentals&lt;/h3&gt;
&lt;p&gt;Terraform enables users to describe infrastructure resources &amp;ndash; and their dependency relationships &amp;ndash; in &lt;code&gt;.tf&lt;/code&gt; files using &lt;a href="https://github.com/hashicorp/hcl"&gt;HCL&lt;/a&gt;, and to automate the creation and ongoing management of that infrastructure via the Terraform command line interface.&lt;/p&gt;</description></item><item><title>Go Concurrency With Goroutines and Channels</title><link>/blog/go-concurrency-with-goroutines-and-channels/</link><pubDate>Sat, 20 Feb 2021 00:00:00 +0000</pubDate><guid>/blog/go-concurrency-with-goroutines-and-channels/</guid><description>&lt;p&gt;&lt;em&gt;Some introductory notes on Go concurrency, goroutines, and channels, largely serving as a slightly-more-indepth supplement to &lt;a href="/blog/channels-in-go/"&gt;a brief 2018 overview and example&lt;/a&gt;.&lt;/em&gt;&lt;/p&gt;
&lt;h2 id="goroutines"&gt;Goroutines&lt;/h2&gt;
&lt;p&gt;Normally, calling a function — &lt;code&gt;foo()&lt;/code&gt;, for example — is a &lt;em&gt;blocking&lt;/em&gt; operation. This means that program execution waits for it to finish before proceeding.&lt;/p&gt;
&lt;p&gt;However, invoking a function with the &lt;code&gt;go&lt;/code&gt; keyword — &lt;code&gt;go foo()&lt;/code&gt;, for example — is &lt;em&gt;non-blocking&lt;/em&gt;. When invoked as &lt;code&gt;go foo()&lt;/code&gt;, Go runs &lt;code&gt;foo()&lt;/code&gt; as a separate task managed by Go. The separate task is called a &lt;a href="https://golang.org/doc/effective_go#goroutines"&gt;&lt;em&gt;goroutine&lt;/em&gt;&lt;/a&gt;. The original Go task — the one Go creates when operating on a program&amp;rsquo;s &lt;code&gt;main&lt;/code&gt; function — is called the &lt;em&gt;main goroutine&lt;/em&gt;. In this case, when &lt;code&gt;foo&lt;/code&gt; is invoked as &lt;code&gt;go foo()&lt;/code&gt;, the main goroutine does not wait for &lt;code&gt;foo()&lt;/code&gt; to finish; it proceeds, as &lt;code&gt;foo()&lt;/code&gt; runs &lt;em&gt;concurrently&lt;/em&gt; in a separate &lt;em&gt;goroutine&lt;/em&gt;.&lt;/p&gt;</description></item><item><title>HTTP Middleware in Go with httptest.ResponseRecorder</title><link>/blog/http-middleware-in-go-with-httptest.responserecorder/</link><pubDate>Sat, 13 Feb 2021 00:00:00 +0000</pubDate><guid>/blog/http-middleware-in-go-with-httptest.responserecorder/</guid><description>&lt;p&gt;&lt;em&gt;A technique for creating &amp;ldquo;post-process&amp;rdquo; HTTP middleware in Go.&lt;/em&gt;&lt;/p&gt;
&lt;h2 id="problem"&gt;Problem&lt;/h2&gt;
&lt;p&gt;You need to add a bit of extra &amp;ldquo;post-process&amp;rdquo; functionality or logic beyond what an existing &lt;a href="https://golang.org/pkg/net/http/#Handler"&gt;http.Handler&lt;/a&gt; offers, but don&amp;rsquo;t have the ability to modify the existing handler, perhaps because it&amp;rsquo;s provided by a third party package. For example, how might you add an HTTP response header to the handler&amp;rsquo;s HTTP response before the response is sent to the client?&lt;/p&gt;
&lt;p&gt;While the &lt;a href="https://medium.com/@matryer/the-http-handler-wrapper-technique-in-golang-updated-bc7fbcffa702"&gt;http.Handler wrapper technique&lt;/a&gt; is commonly utilized to invoke code before and/or after invoking an &lt;code&gt;http.Handler&lt;/code&gt;&amp;rsquo;s &lt;code&gt;ServeHTTP&lt;/code&gt;, method, it doesn&amp;rsquo;t enable post-processing the &lt;code&gt;http.Handler&lt;/code&gt;&amp;rsquo;s handling of the &lt;code&gt;http.ResponseWriter&lt;/code&gt;.&lt;/p&gt;</description></item><item><title>Channels in Go</title><link>/blog/channels-in-go/</link><pubDate>Tue, 09 Jan 2018 00:00:00 +0000</pubDate><guid>/blog/channels-in-go/</guid><description>&lt;p&gt;Through &lt;code&gt;goroutines&lt;/code&gt; and &lt;code&gt;channels&lt;/code&gt;, Go offers constructs for concurrent programming. A &lt;code&gt;goroutine&lt;/code&gt; is a concurrent function execution, while a &lt;code&gt;channel&lt;/code&gt; offers a communication mechanism through which one &lt;code&gt;goroutine&lt;/code&gt; can pass values of a specific type to another &lt;code&gt;goroutine&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;For example, the following code performs three HTTP requests concurrently, reports back the request URL, the request response time, and its HTTP response status code for each request, and also the total time spent executing the program. In this example, the &lt;code&gt;channel&lt;/code&gt; receives a string summarizing the URL, response time, and status code details for each concurrent request, while the &lt;code&gt;main&lt;/code&gt; function prints each string sent to the &lt;code&gt;channel&lt;/code&gt;. The code illustrates that the total time spent executing the program is less than the sum of the times spent waiting for each individual HTTP response, as the HTTP requests are performed concurrently.&lt;/p&gt;</description></item><item><title>Serialize Empty Structs to JSON in Go</title><link>/blog/serialize-empty-structs-to-json-in-go/</link><pubDate>Sun, 04 Jun 2017 00:00:00 +0000</pubDate><guid>/blog/serialize-empty-structs-to-json-in-go/</guid><description>&lt;p&gt;&lt;strong&gt;Problem&lt;/strong&gt;: How can a Golang struct be serialized to JSON &lt;em&gt;without&lt;/em&gt; including an empty object representing an empty struct within the parent struct?&lt;/p&gt;
&lt;p&gt;For example, given a &lt;code&gt;MyStruct&lt;/code&gt; struct such as the following:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-golang" data-lang="golang"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;type&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;MyStruct&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;struct&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#a6e22e"&gt;Data&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;MyData&lt;/span&gt; &lt;span style="color:#e6db74"&gt;`json:&amp;#34;data,omitempty&amp;#34;`&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#a6e22e"&gt;Status&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;string&lt;/span&gt; &lt;span style="color:#e6db74"&gt;`json:&amp;#34;status,omitempty&amp;#34;`&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;And a &lt;code&gt;str&lt;/code&gt; instance of &lt;code&gt;MyStruct&lt;/code&gt; marshal&amp;rsquo;d to JSON:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-golang" data-lang="golang"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#a6e22e"&gt;str&lt;/span&gt; &lt;span style="color:#f92672"&gt;:=&lt;/span&gt; &lt;span style="color:#f92672"&gt;&amp;amp;&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;MyStruct&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#a6e22e"&gt;Status&lt;/span&gt;: &lt;span style="color:#e6db74"&gt;&amp;#34;some-status&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#a6e22e"&gt;j&lt;/span&gt;, &lt;span style="color:#a6e22e"&gt;_&lt;/span&gt; &lt;span style="color:#f92672"&gt;:=&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;json&lt;/span&gt;.&lt;span style="color:#a6e22e"&gt;Marshal&lt;/span&gt;(&lt;span style="color:#a6e22e"&gt;str&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#a6e22e"&gt;Println&lt;/span&gt;(string(&lt;span style="color:#a6e22e"&gt;j&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The yielded JSON contains an empty &lt;code&gt;&amp;quot;data&amp;quot;: {}&lt;/code&gt;, which may be problematic, depending on usage:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-json" data-lang="json"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#f92672"&gt;&amp;#34;data&amp;#34;&lt;/span&gt;: {},
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#f92672"&gt;&amp;#34;status&amp;#34;&lt;/span&gt;: &lt;span style="color:#e6db74"&gt;&amp;#34;some-status&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;How can we get the following JSON in such a data scenario, instead?&lt;/p&gt;</description></item></channel></rss>