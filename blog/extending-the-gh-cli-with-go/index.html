<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Extending the gh CLI with Go | Mike Ball</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=generator content="Hugo 0.101.0"><meta name=ROBOTS content="INDEX, FOLLOW"><link rel=stylesheet href=/main.min.ade9986381ae22db9663db02b239a9a46cd1222e56e0effc0119f6ad2c3ef1cc.css></head><body class=blog-post><header><div class=mark><a href=/>Mike Ball</a></div><button>Toggle Navigation</button><div class=nav-wrap><nav class=primary><ul><li><a href=/blog>Blog</a></li><li><a href=#about>About</a></li></ul></nav><nav class=secondary><ul><li><a href=https://github.com/mdb>GitHub</a></li><li><a href=https://instagram.com/clapclapexcitement>Instagram</a></li></ul></nav><nav class=tertiary><ul><li><a href=https://tiendah.bigcartel.com>Shop</a></li><li><a href=#about>Contact</a></li></ul></nav></div></header><main role=main><div class=blog-post><aside class=divider><a href=/blog/>Blog</a></aside><time>December 28, 2022</time><article><header><h1>Extending the gh CLI with Go</h1></header><div><p><em>GitHub&rsquo;s <a href=https://cli.github.com/>gh CLI</a> can be enhanced via custom extensions. The following offers an introduction, as well as some notes and tips for doing so in Go.</em></p><ol><li><a href=#what?>What?</a></li><li><a href=#extensions>Extensions</a></li><li><a href=#how-do-gh-extensions-work>How do gh extensions work?</a></li><li><a href=#implementation-tips-suggestions-etc>Implementation tips, suggestions, etc.</a></li><li><a href=#bonus-experimental-idea-bootstrapping-developer-experience-and-platform-engineering>Bonus experimental idea: bootstrapping developer experience and platform engineering</a></li><li><a href=#further-reading>Further reading</a></li></ol><h2 id=what>What?</h2><p>Out of the box, the <a href=https://cli.github.com/>gh CLI</a> supports a collection of commands for interacting with GitHub features like repositories, releases, pull requests, and more. For example, to view a repository&rsquo;s open pull requests, use <code>gh pr ls</code>:</p><p><img src=/images/blog/gh_pr_demo.gif alt=demo></p><p><code>gh</code> can be installed via common package managers (<code>brew install gh</code> on Mac OS). It&rsquo;s also preinstalled on all <a href=https://docs.github.com/en/actions/using-workflows/using-github-cli-in-workflows>GitHub-hosted Actions runners</a> and available for use in GitHub Actions CI/CD pipelines, as demonstrated by <a href=https://github.com/mdb/ensure-unpublished-release-action/blob/main/.github/workflows/test.yml#L68>mdb/ensure-unpublished-release-action&rsquo;s release pipeline</a>, which invokes <code>gh release create</code> to publish <a href=https://github.com/mdb/ensure-unpublished-release-action/releases>GitHub releases</a>.</p><h2 id=extensions>Extensions</h2><p>Beyond its built-in features, <code>gh</code> can be extended to support custom commands. I recently created the <a href=https://github.com/mdb/gh-dispatch>gh-dispatch</a> extension for triggering <a href=https://docs.github.com/en/rest/repos/repos#create-a-repository-dispatch-event>repository_dispatch</a> and/or <a href=https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#workflow_dispatch>workflow_dispatch</a> events and watching the resulting <a href=https://github.com/mdb/gh-dispatch/actions/runs/3509863404>GitHub Actions workflow run</a>. Once installed, the extension provides a <code>gh dispatch</code> command:</p><p><img src=/images/blog/gh_dispatch_demo.gif alt=demo></p><p><code>gh extension install</code> installs extensions from their GitHub repositories. To install <code>gh-dispatch</code>:</p><pre tabindex=0><code>gh extension install mdb/gh-dispatch
</code></pre><p>&mldr;and to view all installed extensions, use <code>gh extension list</code>:</p><pre tabindex=0><code>gh actions-importer  github/gh-actions-importer    v1.0.1
gh actions-status    rsese/gh-actions-status       v1.0.0
gh dash              dlvhdr/gh-dash                v3.4.1
gh dispatch          mdb/gh-dispatch               0.0.1
gh markdown-preview  yusukebe/gh-markdown-preview  198c536b
gh metrics           hectcastro/gh-metrics         v2.1.0
</code></pre><p>A few extensions of note include&mldr;</p><ul><li><a href=https://github.com/dlvhdr/gh-dash>gh-dash</a> - a Terminal dashboard for GitHub issues and pull requests</li><li><a href=https://github.com/redraw/gh-install>gh-install</a> - install GitHub release binaries</li><li><a href=https://github.com/chelnak/gh-changelog>gh-changelog</a> - create <a href=https://keepachangelog.com/en/1.0.0/>keep a changelog</a>-style changelogs</li></ul><p>To see other community-maintained <code>gh</code> extensions, <a href=https://github.com/topics/gh-extension>browse GitHub repositories tagged with the &ldquo;gh-extension&rdquo; topic</a>.</p><p>(And if you&rsquo;ve got improvement ideas for <code>gh-dispatch</code>, <a href=https://github.com/mdb/gh-dispatch>open a PR</a>!)</p><h2 id=how-do-gh-extensions-work>How do gh extensions work?</h2><p>Under the hood, <code>gh</code> CLI extensions are <code>gh-</code>-prefixed executables located at a standard path (sidebar: this is similar to how <a href=https://kubernetes.io/docs/tasks/extend-kubectl/kubectl-plugins/>kubectl plugins</a> work too). For example, on Mac OS, the executables live in <code>~/.local/share/gh/extensions</code>:</p><pre tabindex=0><code>ls ~/.local/share/gh/extensions
gh-actions-importer gh-dispatch gh-metrics
gh-actions-status   gh-dash     gh-markdown-preview
</code></pre><p>With this in mind, a rudimentary extension might be a simple <code>bash</code> script named and located accordingly:</p><pre tabindex=0><code>cat ~/.local/share/gh/extensions/gh-hello/gh-hello
#!/bin/bash

echo &#34;hello&#34;
</code></pre><p>&mldr;and thereby executable as a <code>gh</code> subcommand:</p><pre tabindex=0><code>gh hello
hello
</code></pre><p>So, returning to the <a href=https://github.com/mdb/gh-dispatch>gh-dispatch</a> example&mldr;</p><p><code>gh extension install mdb/gh-dispatch</code> fetches the <code>gh-dispatch</code> extension from GitHub and, at least in the case of Mac OS, installs it to the <code>~/.local/share/extensions/gh-dispatch</code> path. Because <code>gh-dispatch</code>&rsquo;s own <a href=https://github.com/mdb/gh-dispatch/actions/workflows/cicd.yaml>build process</a> precompiles the extension for various OS/architecture combos and publishes the resulting binaries to a <a href=https://github.com/mdb/gh-dispatch/releases/>GitHub release</a>, <code>gh extension install</code> knows to download the correct binary associated with the targeted release version (by default, it fetches the latest release, though specific versions can be targeted with a <code>--pin</code> option).</p><p>(Arguably, all this becomes especially compelling when considering the growing ubiquity of GitHub, the widespread popularity of the <code>gh</code> CLI, and that <code>gh extension install</code> requires no additional package managers, local runtimes, or developer environment setup, at least in the case of precompiled extensions like <a href=https://github.com/mdb/gh-dispatch>gh-dispatch</a>. So, with this in mind, perhaps a custom <code>gh</code> extension could be leveraged as a sensible entrypoint when bootsrapping higher level developer experiences for an organization &ndash; think platform onboarding, environment setup, repository generation, secrets management, build utilities, etc. But, more on all that later.)</p><h2 id=implementation-tips-suggestions-etc>Implementation tips, suggestions, etc.</h2><p>While a <code>gh</code> extension can be authored in any language, Go is an especially good fit for a few reasons:</p><ol><li><p>The <code>gh</code> CLI itself is authored in Go.</p><p>Because <code>gh</code> itself is written in Go using the <a href=https://cobra.dev/>Cobra framework</a>, its source code offers lotsa helpful examples and patterns. For example, the <code>gh pr ls</code> <a href=https://github.com/cli/cli/blob/v2.21.1/pkg/cmd/pr/list/list.go>implementation</a> reveals how <code>gh</code> subcommands are declared as a <a href=https://pkg.go.dev/github.com/spf13/cobra#Command>&cobra.Command</a>.</p><p>Furthermore, the packages homed in <a href=https://github.com/cli/cli/>https://github.com/cli/cli/</a> can also be imported by extension source code, which enables helpful reuse patterns. As an example, <code>gh-dispatch</code> leverages upstream <a href=https://github.com/cli/cli/>https://github.com/cli/cli/</a> packages, particularly when <a href=https://github.com/mdb/gh-dispatch/blob/main/internal/dispatch/renderutils.go>rendering output</a>. A few other packages of note include&mldr;</p><ul><li><a href=https://github.com/cli/cli/tree/v2.21.1/api>github.com/cli/cli/v2/api</a> - a GitHub API client.</li><li><a href=https://github.com/cli/cli/tree/v2.21.1/pkg/httpmock>github.com/cli/cli/v2/pkg/httpmock</a> - utilities for mocking HTTP transactions during automated tests (see <a href=https://github.com/mdb/gh-dispatch/blob/0.1.3/internal/dispatch/repository_test.go>gh-dispatch&rsquo;s own tests</a> for example usage).</li><li><a href=https://github.com/cli/cli/tree/v2.21.1/pkg/iostreams>github.com/cli/cli/v2/pkg/iostreams</a> - utilities for working with IO and rendering CLI extension output.</li></ul><p>Disclaimer: I&rsquo;m not actually sure the <code>gh</code> maintainers intend for these packages to be used outside the CLI codebase, but it can be done.</p></li><li><p><a href=https://github.com/cli/go-gh>github.com/cli/go-gh</a> can be used by Go-based extensions.</p><p>In addition to the <a href=https://github.com/cli/cli/>https://github.com/cli/cli/</a> packages, <code>github.com/cli/go-gh</code> is also available to Go-based extension developers. According to <code>go-gh</code>&rsquo;s own <code>README:</code></p><blockquote><p><code>go-gh</code> is a collection of Go modules to make authoring <a href=https://docs.github.com/en/github-cli/github-cli/creating-github-cli-extensions>GitHub CLI extensions</a> easier.</p></blockquote><p>For example, <code>gh-dispatch</code> uses <a href=https://github.com/cli/go-gh/tree/v1.0.0/pkg/auth>github.com/cli/go-gh/pkg/auth</a> and <a href=https://github.com/cli/go-gh/tree/v1.0.0/pkg/config>github.com/cli/go-gh/pkg/config</a> to ensure the extension authenticates users to GitHub via the same patterns used by the core <code>gh</code> CLI.</p></li><li><p>Go programs can be easily precompiled across OS/architecture combos.</p><p>By precompiling a CLI extension, users can install and run the extension without additional run time dependencies (i.e. bash, Ruby, Python, etc.) beyond the <code>gh</code> CLI itself, nor is it necessary to provide users any per-OS/per-architecture installation instructions; <code>gh extension install &lt;OWNER>/&lt;REPO></code> simply downloads the appropriate binary from the <code>&lt;OWNER>/&lt;REPO></code> GitHub releases (For example, note the precompiled binaries associated with each of <a href=https://github.com/mdb/gh-dispatch/releases>gh-dispatch&rsquo;s GitHub releases</a>).</p><p>Also helpful: <a href=https://github.com/cli/gh-extension-precompile>gh-extension-precompile</a> is a reusable GitHub Action for automating the publication of such binaries to GitHub releases, saving Go-based extension authors from writing their own CI/CD automation. However, if you&rsquo;d prefer to write your own release automation &ndash; or to use <a href=https://goreleaser.com/>goreleaser</a> directly, as <a href=https://github.com/mdb/gh-dispatch/blob/main/.github/workflows/cicd.yaml>gh-dispatch&rsquo;s release process does</a> &ndash; that&rsquo;s not too hard, either (just make sure the precompiled binaries are named correctly; <code>gh extension install</code> assumes a naming convention. When in doubt, emulate a known working example, such as <a href=https://github.com/mdb/gh-dispatch>gh-dispatch</a>).</p></li></ol><h2 id=bonus-experimental-idea-bootstrapping-developer-experience-and-platform-engineering>Bonus experimental idea: bootstrapping developer experience and platform engineering</h2><p>While <code>gh</code> extensions can be useful in and of themselves (I use <a href=https://github.com/dlvhdr/gh-dash>gh-dash</a> every day!), the ecosystem teases some broader possibilities: could a <code>gh</code> extension sensibly serve as the cornerstone of an organization&rsquo;s developer platform experience?</p><p>In my experience, it&rsquo;s common for engineering leadership to fantasize about a cohesive internal developer platform, often facilitated via a purpose-built CLI, web portal, and/or API, and enabling developer efficiency via stuff like&mldr;</p><ul><li>a standard interface to centralized automation</li><li>automated software project setup and repository scaffolding</li><li>the generation and maintenance of standard, templated CI/CD pipelines</li><li>the maintenance of source code repository best practices, such as <a href=https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/collaborating-on-repositories-with-code-quality-features/about-status-checks>standard required status checks</a> and <a href=https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/reviewing-changes-in-pull-requests/approving-a-pull-request-with-required-reviews>required PR code review approvals</a></li><li>per-team public cloud provider account provisioning and infrastructure configuration</li><li>sensible management of role-based access control, secrets (such as API credentials), adherence to the principle of least privilege and similar security-sensitive safeguards, etc.</li><li>a common interface to otherwise disparate tools, such as documentation, project management, dashboards, etc.</li><li>a general purpose mechanism for self-service and the discovery of ever-evolving internal platform capabilities</li></ul><p>However, depending on context (org size, engineering practices, priorities, etc.), building such a developer platform involves labor and complexity that may jeopardize more business-critical efforts, especially when doing so invests in proprietary solutions to common needs. To varying degrees, open tools like <a href=https://backstage.io>Backstage</a> and various <a href=https://internaldeveloperplatform.org/>Internal Developer Platforms</a> aim to help. Zooming out, even Kubernetes itself &ndash; despite its complexity &ndash; aspires to be an open, common, standard-ish platform. Technologies like <a href=https://github.com/kubevela/kubevela>Kubevela</a>, <a href=https://argoproj.github.io/>Argo</a>, and <a href=https://fluxcd.io/>Flux</a> further enhance the Kubernetes platform experience, each in their own way. These are promising tools. But, perhaps building on the ubiquity of the existing GitHub ecosystem via a custom <code>gh</code> extension might be a relatively low-effort, low-risk compliment to your organization&rsquo;s developer experience as well? Or maybe a sensible entrypoint before tools beyond GitHub are implicated?</p><p>(In my experience, an organization-specific <code>gh</code> extension becomes especially attractive when it serves as an interface to other commonly-used GitHub features: GitHub Actions workflows, infrastructure-as-code automation, GitHub pages-hosted JSON endpoints, GitHub secrets, GitHub repository environments, GitHub template repositories, GitHub teams, etc. From this perspective, perhaps GitHub itself emerges as a practical foundation to a robust internal developer platform ecosystem, with a custom <code>gh</code> extension tying it all together as a cohesive user experience.)</p><p>A big disclaimer, though: all this <code>gh</code>-extension-facilitated developer experience talk is bit experimental and largely intended as food for thought. Context matters in nuanced ways, do your own thinkin&rsquo;/assessin&rsquo;, your mileage may vary, maybe <a href=https://en.wikipedia.org/wiki/You_aren%27t_gonna_need_it>YAGNI</a>, etc. Plus, even in absence of big developer experience ambitions, the <code>gh</code> CLI and its community-maintained extensions have clear small-scale utility.</p><h2 id=further-reading>Further reading</h2><ul><li><a href=https://cli.github.com/manual/gh_extension>gh documentation</a></li><li><a href=https://docs.github.com/en/github-cli/github-cli/creating-github-cli-extensions>Creating GitHub CLI Extensions</a></li><li><a href=https://github.com/topics/gh-extension>Community-maintained extensions</a></li></ul></div><ul class=tags><li><a href=/tags/go>go</a></li><li><a href=/tags/platform-engineering>platform engineering</a></li><li><a href=/tags/github>github</a></li><li><a href=/tags/cli>cli</a></li></ul></article></div></main><footer><section><h1 id=about>Info</h1><div><h2>Mike Ball</h2><p>I live in Philadelphia and work as a multi-disciplinary software engineer & designer.</p><p>Over the years, I've developed front end web applications, built backend services, automated cloud infrastructure management, designed CI/CD pipelines for high scale distributed systems, and contributed to numerous open source software projects.</p><p>I've also worked in graphic and UX design. Buy prints of my illustrations at <a href=https://tiendah.bigcartel.com>Tiendah</a>.</div><div class=double><h2>Shop Tiendah</h2><ul class="gallery store-feed"></ul><h2>Instagram</h2><ul class="gallery ig-feed"></ul></div><div><h2>Etc.</h2><ul><li><a href=http://github.com/mdb>GitHub</a></li><li><a href=http://twitter.com/clapexcitement>Twitter</a></li><li><a href=https://instagram.com/clapclapexcitement>Instagram</a></li><li><a href=/index.xml>RSS Feed</a></li><li><a href=https://tiendah.bigcartel.com>Shop Tiendah</a></li></ul><h2>Contact</h2><p>Interested in working with me? <a href=mailto:mikedball@gmail.com>Get in touch</a>.</p></div></section></footer><script type=text/javascript src=/js/main.min.293095ab78ab0063790d59dc6e7fd31835bb02930d51ededffd136ed11be427f.js></script>
<script type=text/javascript>(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)})(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-54324621-1","auto"),ga("send","pageview")</script></body></html>