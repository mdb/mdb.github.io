<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Packer on Mike Ball</title><link>/tags/packer/</link><description>Recent content in Packer on Mike Ball</description><generator>Hugo</generator><language>en-us</language><lastBuildDate>Sat, 15 Mar 2025 00:00:00 +0000</lastBuildDate><atom:link href="/tags/packer/index.xml" rel="self" type="application/rss+xml"/><item><title>Packer: conditionally omit HCL block configuration</title><link>/blog/packer-conditionally-omit-hcl-block-configuration/</link><pubDate>Sat, 15 Mar 2025 00:00:00 +0000</pubDate><guid>/blog/packer-conditionally-omit-hcl-block-configuration/</guid><description>&lt;h2 id="problem"&gt;Problem&lt;/h2&gt;
&lt;p&gt;You&amp;rsquo;re using &lt;a href="https://www.packer.io/"&gt;Packer&lt;/a&gt; to build &lt;a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/AMIs.html"&gt;AWS EC2 AMIs&lt;/a&gt;. How can you
parameterize builds to conditionally configure or omit &lt;a href="https://developer.hashicorp.com/packer/integrations/hashicorp/amazon/latest/components/builder/ebs#ebs-specific-configuration-reference"&gt;amazon-ebs.launch_block_device_mappings&lt;/a&gt;
based on the value of an &lt;a href="https://developer.hashicorp.com/packer/guides/hcl/variables"&gt;input variable&lt;/a&gt;?&lt;/p&gt;
&lt;h2 id="solution"&gt;Solution&lt;/h2&gt;
&lt;p&gt;Leverage &lt;a href="https://developer.hashicorp.com/packer/docs/templates/hcl_templates/expressions#dynamic-blocks"&gt;dynamic blocks&lt;/a&gt;; based on an input variable value, pass a &lt;code&gt;for_each&lt;/code&gt; argument with a length of 0 to omit the configuration of &lt;code&gt;launch_block_device_mappings&lt;/code&gt;.&lt;/p&gt;
&lt;h2 id="example"&gt;Example&lt;/h2&gt;
&lt;p&gt;The following Packer template supports a &lt;code&gt;create_nonroot_devices&lt;/code&gt; input variable.
By default, its value is &lt;code&gt;false&lt;/code&gt;; &lt;code&gt;packer build&lt;/code&gt; results in an AMI with no
nonroot &lt;code&gt;launch_block_device_mappings&lt;/code&gt;:&lt;/p&gt;</description></item></channel></rss>